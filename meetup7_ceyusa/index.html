<!DOCTYPE html><html xmlns="http://www.w3.org/1999/xhtml"><head><title>gstreamer-rs: multimedia con Rust</title><meta charset="UTF-8"></meta><meta name="generator" content="Hovercraft! 1.0 http://regebro.github.com/hovercraft"></meta><meta name="author" content="V&#xED;ctor J&#xE1;quez &lt;vjaquez at igalia dot com&gt;"></meta><meta name="description" content="Introducci&#xF3;n al desarrollo de aplicaciones multimedia con
GStreamer y Rust - MadRust 2019"></meta><meta name="keywords" content="slides, impress.js, gstreamer, rust, multimedia, madrust"></meta><link rel="stylesheet" href="css/hovercraft.css" media="all"></link><link rel="stylesheet" href="css/impressConsole.css" media="all"></link><link rel="stylesheet" href="css/highlight.css" media="all"></link><link rel="stylesheet" href="css/custom.css" media="screen,projection"></link><script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        showProcessingMessages: false,
        messageStyle: "none",
        TeX : { extensions : ['color.js'] }
      });
    </script></head><body class="impress-not-supported"><div id="impress" auto-console="false"><div class="step step-level-1 bullet-hand" step="0" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="0" data-y="0" data-z="0"><h1 id="gstreamer-rs-multimedia-con-rust">gstreamer-rs: multimedia con Rust</h1><h2 id="victor-jaquez-vjaquez-at-igalia-dot-com"><strong>V&#xED;ctor J&#xE1;quez &lt;vjaquez at igalia dot com&gt;</strong></h2><h3 id="madrid-2019">Madrid 2019</h3><h4 id="agenda">Agenda</h4><ul><li>&#xBF;Qu&#xE9; es GStreamer?</li><li>Conceptos de GStreamer</li><li>Tutorial b&#xE1;sico</li><li>Tutorial de reproducci&#xF3;n de audio y v&#xED;deo</li><li>Tutorial para crear un elemento</li></ul></div><div class="step step-level-1 bullet-arrow" step="1" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="1600" data-y="0" data-z="0"><h1 id="que-es-gstreamer">&#xBF;Qu&#xE9; es GStreamer?</h1><p>GStreamer es un <em>framework</em> para desarrollar casi cualquier tipo de aplicaciones
multimedia.</p><ul><li>Escrito en C utilizando la biblioteca y el estilo de GLib/GObject</li><li>Su dise&#xF1;o general sigue el patr&#xF3;n de filtros y tuber&#xED;as</li><li>No s&#xF3;lo procesa flujos de audio y v&#xED;deo, sino cualquier tipo flujo<ul><li>an&#xE1;lisis de las ondas gravitacionales (<a href="https://lscsoft.docs.ligo.org/gstlal/">GstLAL</a>)</li><li>procesamiento de <a href="https://github.com/nnsuite/nnstreamer">redes neuronales</a> y <a href="https://developer.nvidia.com/deepstream-sdk">machine learning</a></li></ul></li></ul></div><div class="step step-level-1 centered huge bold red white-outline" step="2" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="3200" data-y="0" data-z="0"><img src="img/gstreamer-overview.png" width="100%" class="centered"></img></div><div class="step step-level-1 bullet-star" step="3" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="4800" data-y="0" data-z="0"><h1 id="palabros">Palabros</h1><ul><li><strong>Plugins</strong><ul><li>Core</li><li>Base</li><li>Good</li><li>Bad</li><li>Ugly</li><li>Extras</li></ul></li></ul><ul><li><strong>Elements</strong><ul><li>gesti&#xF3;n de protocolos</li><li>sources (recepci&#xF3;n de flujos)</li><li>formato (parsers, muxers/demuxers, etc.)</li><li>codecs (encoders/decoders)</li><li>filtros (converters, mixers, effects)</li><li>sinks (despliegue de flujos procesados)</li></ul></li></ul></div><div class="step step-level-1 bullet-star" step="4" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="6400" data-y="0" data-z="0"><h1 id="mas-palabros">M&#xE1;s palabros</h1><ul><li><strong>Elements</strong>: unidad de procesamiento. Tiene uno o varios pads.</li><li><strong>Pads</strong>: componentes de entrada o salida de flujos dentro de un
elemento. Negocian la encadenaci&#xF3;n de elementos y el flujo de datos entre
ellos.</li><li><strong>Bin</strong>: contenedor de elementos que mantienen un mismo estado interno.</li><li><strong>Pipeline</strong>: bin ra&#xED;z. Tiene un bus.</li><li><strong>Bus</strong>:  paso de mensajes entre pipeline y aplicaci&#xF3;n.</li></ul></div><div class="step step-level-1 centered huge bold red white-outline" step="5" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="8000" data-y="0" data-z="0"><img src="img/simple-player.png" width="100%" class="centered"></img></div><div class="step step-level-1 bullet-star" step="6" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="9600" data-y="0" data-z="0"><h1 id="comunicacion">Comunicaci&#xF3;n</h1><ul><li><strong>buffers</strong>: objetos que pasan los datos del flujo entre elementos. Siempre
van de <em>sources</em> a <em>sinks</em> (<em>downstream</em>)</li><li><strong>events</strong>: objetos enviados entre elementos o desde la aplicaci&#xF3;n a los
elementos. Pueden ir hacia <em>upstream</em> o <em>downstream</em>.</li><li><strong>messages</strong>: objetos publicados por los elementos en el <em>bus</em> del <em>pipeline</em>
donde pueden ser atendidos por la aplicaci&#xF3;n de manera as&#xED;ncrona (por lo
general).</li><li><strong>queries</strong>: objetos que representan la solicitud de informaci&#xF3;n a un
elemento, ya sea desde la aplicaci&#xF3;n (de manera s&#xED;ncrona) o entre elementos
(<em>upstream</em> o <em>downstream</em>)</li></ul></div><div class="step step-level-1 centered huge bold red white-outline" step="7" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="11200" data-y="0" data-z="0"><img src="img/communication.png" width="100%" class="centered"></img></div><div class="step step-level-1 bullet-star column-2" step="8" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="12800" data-y="0" data-z="0"><h1 id="elements">Elements</h1><ul><li><img src="img/src-element.png" width="300px"></img></li><li><img src="img/filter-element.png" width="300px"></img></li><li><img src="img/filter-element-multi.png" width="300px"></img></li><li><img src="img/sink-element.png" width="300px"></img></li></ul></div><div class="step step-level-1 bullet-star" step="9" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="14400" data-y="0" data-z="0"><h1 id="id1">Elements</h1><ul><li>Descendientes de GObject &#x2192; GstElement</li><li>Estados de cada elemento<ul><li>NULL: sin recursos adjudicados</li><li>READY: con recursos globales adjudicados, sin flujo abierto</li><li>PAUSED: con flujo abierto, procesamiento m&#xED;nimo sin mover buffers</li><li>PLAYING: procesando y moviendo buffers</li></ul></li></ul></div><div class="step step-level-1 bullet-star" step="10" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="16000" data-y="0" data-z="0"><h1 id="id2">Elements</h1><ul><li>Los elementos se vinculan entre s&#xED; (<em>linking</em>) formando grafos dirigidos</li></ul><img src="img/linked-elements.png" width="545px" class="centered"></img></div><div class="step step-level-1 bullet-star" step="11" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="17600" data-y="0" data-z="0"><h1 id="bin">Bin</h1><ul><li>Tipo particular de elemento que contiene a otros elementos y gestiona sus
estados</li></ul><img src="img/bin-element.png" width="593px" class="centered"></img></div><div class="step step-level-1 bullet-star" step="12" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="19200" data-y="0" data-z="0"><h1 id="bus">Bus</h1><ul><li>Es un mecanismo de paso de mensajes desde los hilos lanzados por los elementos
y la aplicaci&#xF3;n.</li><li>Tipos de mensajes<ul><li>Errores, advertencias y notificaciones</li><li>Notificaci&#xF3;n de <em>End-Of-Stream</em> (EOS)</li><li>Metadatos</li><li>Cambios de estado</li><li><em>Buffering</em></li><li>Mensajes especiales de ciertos elementos</li><li>Solicitudes de contexto</li></ul></li></ul></div><div class="step step-level-1 bullet-star" step="13" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="20800" data-y="0" data-z="0"><h1 id="pads">Pads</h1><ul><li>Las puertas de los elementos para recibir y emitir <em>buffers</em>, <em>queries</em> y
<em>events</em></li><li>Propiedades<ul><li>Direcci&#xF3;n: <em>source</em> / <em>sink</em></li><li>Disponibilidad: <em>always</em> / <em>sometimes</em> / <em>on request</em></li><li>Capacidades (<em>caps</em>): descripci&#xF3;n del tipo de flujo el <em>pad</em> emite o recibe</li></ul></li></ul></div><div class="step step-level-1 bullet-star" step="14" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="22400" data-y="0" data-z="0"><h1 id="caps">Caps</h1><ul><li>Diccionarios de datos (llave/valor) asociados a un tipo <em>MIME</em></li></ul><pre class="highlight ">audio/x-raw
              format: F32LE
                rate: [ 1, 2147483647 ]
            channels: [ 1, 256 ]</pre><pre class="highlight ">video/x-h264
       stream-format: { (string)avc, (string)byte-stream }
           alignment: au
             profile: { (string)constrained-baseline, &#x2026; }</pre><ul><li>La negociaci&#xF3;n de <em>caps</em> es una operaci&#xF3;n de intersecci&#xF3;n de conjuntos</li></ul></div><div class="step step-level-1 bullet-star" step="15" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="24000" data-y="0" data-z="0"><h1 id="buffers">Buffers</h1><ul><li>&#xC1;reas de memoria que contienen los datos que fluyen a trav&#xE9;s del <em>pipeline</em></li></ul><h1 id="events">Events</h1><ul><li>Part&#xED;culas de control que se env&#xED;an <em>upstream</em> o <em>downstream</em> para notificar a
los elementos siguientes sobre el estado del flujo: <em>seek</em> / <em>flush</em> / <em>eos</em></li></ul></div><div class="step step-level-1 bullet-star" step="16" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="25600" data-y="0" data-z="0"><h1 id="rust-bindings">Rust Bindings</h1><ul><li>GStreamer est&#xE1; escrito en C/GObject</li><li>Se crean <em>bindings</em> autom&#xE1;ticos con la utiler&#xED;a gir</li></ul><p><a href="https://github.com/gtk-rs/gir">https://github.com/gtk-rs/gir</a></p><h1 id="gir">gir</h1><ul><li>gir genera dos capas de <em>bindings</em><ul><li><strong>sys</strong>: <em>bindings</em> de bajo nivel FFI (<em>foreign function interface</em>) --
generalmente <em>unsafe</em></li><li><strong>api</strong>: <em>bindings</em> de alto nivel, <em>rustificados</em>, usando <strong>sys</strong></li></ul></li></ul></div><div class="step step-level-1 bullet-star" step="17" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="27200" data-y="0" data-z="0"><h1 id="ficheros-gir">ficheros gir</h1><ul><li>Ambos modos de generaci&#xF3;n de bindigins utilizan ficheros gir<ul><li>ficheros en formato <em>xml</em> que describen la API en C</li><li>GObject Introspection Repository</li></ul></li></ul><img src="img/gir-overview.png" width="800px"></img></div><div class="step step-level-1 bullet-star" step="18" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="28800" data-y="0" data-z="0"><h1 id="ejecutando-comando-gir">ejecutando comando gir</h1><ul><li><strong>sys</strong></li></ul><pre class="highlight code sh">cargo run --release -- -c YourSysGirFile.toml <span class="se">\
</span>     -d ../gir-files -m sys -o the-output-directory-sys</pre><ul><li><strong>api</strong></li></ul><pre class="highlight code sh">cargo run --release -- -c YourGirFile.toml <span class="se">\
</span>     -d ../gir-files -o the-output-directory</pre></div><div class="step step-level-1 bullet-star" step="19" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="30400" data-y="0" data-z="0"><h1 id="oxidando-elementos">oxidando elementos</h1><img src="img/rust-cohle.jpg" width="614px" class="centered"></img></div></div><div id="hovercraft-help" class="hide"><table><tr><th>Space</th><td>Forward</td></tr><tr><th>Right, Down, Page Down</th><td>Next slide</td></tr><tr><th>Left, Up, Page Up</th><td>Previous slide</td></tr><tr><th>G</th><td>Go to slide number</td></tr><tr><th>P</th><td>Open presenter console</td></tr><tr><th>H</th><td>Toggle this help</td></tr></table></div><script type="text/javascript" src="js/impress.js"></script><script type="text/javascript" src="js/impressConsole.js"></script><script type="text/javascript" src="js/hovercraft.js"></script></body></html>